# Скрипт автоматичного резервного копіювання MikroTik (через Email)

Цей скрипт для RouterOS автоматизує процес створення резервних копій конфігурації MikroTik та надсилає їх на вказану електронну адресу. Він генерує як текстовий експорт конфігурації (`.rsc`), так і бінарний файл резервної копії (`.backup`), зашифрований за допомогою AES-SHA256.

**Тестувався на версії RouterOS: 7.19.1**

## Основні можливості:

* **Два типи резервних копій:**
    * Створення файлу експорту конфігурації (`/export file=filename.rsc`).
    * Створення повного бінарного файлу резервної копії (`/system backup save name=filename.backup`) з шифруванням AES-SHA256.
* **Пароль з файлу:** Пароль для шифрування бінарного бекапу читається безпосередньо з вказаного локального файлу.
    * **Важливо:** Скрипт *припускає, що цей файл існує*, і використовує його вміст *"як є"* (без обрізки пробільних символів чи переносів рядків). Якщо файл відсутній, скрипт завершиться з помилкою. Будь-які переноси рядків або пробіли у файлі стануть частиною пароля, що потенційно може призвести до проблем з розшифруванням бекапу.
* **Сповіщення на Email:** Надсилає обидва файли резервних копій як вкладення.
* **Системна інформація в листі:** Тіло листа містить ключову системну інформацію:
    * Ім'я пристрою, модель, версія RouterOS, версія прошивки.
    * Використання ресурсів: місце на диску, пам'ять, час безперервної роботи.
* **Без логів у листі:** Ця версія скрипта **не збирає** та **не включає** системні логи до тіла електронного листа для його стислості.
* **Іменування файлів з часовою міткою:** Файли резервних копій іменуються з використанням імені системи та мітки часу (РРРР-Місяць-ДД-ГГХХ) для легкої ідентифікації.
* **Автоматичне очищення:** Видаляє файли резервних копій з маршрутизатора після успішної відправки електронного листа.
* **Обробка помилок:** Включає блоки `do...on-error` для критично важливих операцій.

## Конфігурація:

1.  **Змінні у скрипті (на початку):**
    * `:local EmailTo "your_email@example.com";` - Вкажіть вашу адресу електронної пошти для отримання резервних копій.
    * `:local PasswordFileName "password_file.txt";` - Вкажіть ім'я файлу, що зберігає пароль шифрування. Цей файл має знаходитися в кореневій файловій системі MikroTik.
2.  **Файл пароля:**
    * Створіть вказаний файл пароля (наприклад, `password_file.txt`) у кореневому каталозі файлової системи вашого MikroTik.
    * Запишіть у цей файл **тільки** потрібний пароль шифрування. Будьте обережні із зайвими пробілами або символами нового рядка, оскільки вони будуть розглядатися як частина пароля.
3.  **Налаштування Email на MikroTik:**
    * Переконайтеся, що на вашому маршрутизаторі правильно налаштовано відправку пошти через `/tool e-mail` (SMTP-сервер, порт, облікові дані за потреби).

## Використання:

* **Важливо:** Щоб ім'я файлу пароля (`PasswordFileName`) не потрапило до експорту конфігурації `.rsc`, цей скрипт призначений для запуску безпосередньо з Планувальника MikroTik.
* Скопіюйте **весь вихідний код скрипта** та вставте його в поле `On Event` нового завдання Планувальника (`/system scheduler`).
* Встановіть бажаний інтервал для планувальника (наприклад, щодня).

## Примітки щодо пароля шифрування:

* Бінарний файл резервної копії (`.backup`) використовує пароль, прочитаний із зазначеного файлу, для шифрування AES-SHA256.
* Пам'ятайте, що RouterOS v6.43 і новіші версії створять *незашифрований* бекап, якщо рядок пароля, наданий команді `/system backup save`, порожній. Цей скрипт виводить попередження, якщо файл пароля знайдено, але його вміст порожній.
